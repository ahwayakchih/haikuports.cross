name: bootstrap
on:
  push:
    branches: [ workflow ]
  pull_request:
    branches: [ workflow ]
jobs:
  bootstrap-riscv64:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: install missing tools
      # attr is for setfattr - to use extended attributes
      run: sudo apt install -y nasm attr
    - name: git haiku
      run: git -C .. clone --depth 1 https://review.haiku-os.org/haiku
    - name: git buildtools
      run:  git -C .. clone --depth 1 https://review.haiku-os.org/buildtools
    - name: git haikuports
      run: git -C .. clone --depth 1 https://github.com/haikuports/haikuports
    - name: git haikuporter
      run: git -C .. clone --depth 1 https://github.com/haikuports/haikuporter
    - name: jam it
      run: cd ../buildtools/jam && make && ./jam0 install && cd ../..
    - name: setup
      run: mkdir ../bootstrap
    - name: configure
      run: cd ../bootstrap && ../haiku/configure --build-cross-tools riscv64 --cross-tools-source ../buildtools --bootstrap ../haikuporter/haikuporter ../haikuports.cross ../haikuports -j$(nproc)
    - name: output info
      run: |
        ls -l ../bootstrap
        ../bootstrap/gcc --version
